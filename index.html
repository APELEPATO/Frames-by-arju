<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frames by Arju</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 2s ease-in-out; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-black text-white">

    <div id="loader" class="fixed inset-0 flex items-center justify-center bg-black z-50">
        <h1 class="text-3xl md:text-5xl font-bold animate-fade text-orange-500 tracking-tighter">FRAMES BY ARJU</h1>
    </div>

    <div id="app" class="hidden p-4">
        <header class="text-center mb-8">
            <h2 class="text-xl font-light tracking-widest uppercase">Gallery</h2>
            
            <div id="admin-panel" class="hidden mt-5 p-4 border border-dashed border-gray-600 rounded">
                <p class="text-xs text-gray-400 mb-2 font-bold">ADMIN PANEL</p>
                <input type="file" id="file-input" multiple accept="image/*" class="hidden">
                <button onclick="document.getElementById('file-input').click()" class="bg-white text-black px-4 py-2 rounded text-sm font-bold">ADD PHOTOS</button>
                <button id="qr-gen-btn" onclick="toggleQR()" class="bg-orange-600 px-4 py-2 rounded text-sm font-bold ml-2 hidden">GENERATE QR</button>
            </div>
        </header>

        <div id="qr-box" class="hidden bg-white p-4 rounded-lg mx-auto max-w-[250px] text-center mb-8">
            <div id="qrcode" class="flex justify-center"></div>
            <p class="text-black text-xs mt-2 font-bold uppercase">Scan to share this gallery</p>
        </div>

        <div id="user-controls" class="flex justify-between items-center mb-4">
            <span id="photo-count" class="text-xs text-gray-400">0 Photos</span>
            <button onclick="downloadAllZip()" class="bg-green-600 text-[10px] px-3 py-1 rounded-full uppercase font-bold">Download All (ZIP)</button>
        </div>

        <div id="gallery" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
    </div>

    <script>
        let photos = [];
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('admin') === 'true';

        // Welcome Screen logic
        setTimeout(() => {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('app').classList.remove('hidden');
            if(isAdmin) document.getElementById('admin-panel').classList.remove('hidden');
        }, 2500);

        // File Selection
        document.getElementById('file-input').addEventListener('change', function(e) {
            const files = e.target.files;
            if(files.length > 0) document.getElementById('qr-gen-btn').classList.remove('hidden');

            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const photoData = event.target.result;
                    photos.push(photoData);
                    renderGallery();
                };
                reader.readAsDataURL(file);
            }
        });

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const count = document.getElementById('photo-count');
            gallery.innerHTML = "";
            count.innerText = `${photos.length} Photos`;

            photos.forEach((src, index) => {
                const div = document.createElement('div');
                div.className = "relative group aspect-square rounded-lg overflow-hidden bg-gray-900";
                div.innerHTML = `
                    <img src="${src}" class="w-full h-full object-cover cursor-pointer" onclick="previewImage('${src}')">
                    <div class="absolute bottom-1 right-1 flex gap-1">
                        <a href="${src}" download="photo_${index}.jpg" class="bg-black/50 p-1 rounded text-[10px]">Save</a>
                        ${isAdmin ? `<button onclick="deletePhoto(${index})" class="bg-red-600/80 p-1 rounded text-[10px]">X</button>` : ''}
                    </div>
                `;
                gallery.appendChild(div);
            });
        }

        function deletePhoto(index) {
            photos.splice(index, 1);
            renderGallery();
        }

        function previewImage(src) {
            const win = window.open();
            win.document.write(`<body style="margin:0;background:#000;display:flex;align-items:center;justify-content:center;"><img src="${src}" style="max-width:100%;max-height:100%;"></body>`);
        }

        function toggleQR() {
            const qrBox = document.getElementById('qr-box');
            qrBox.classList.toggle('hidden');
            if(!qrBox.classList.contains('hidden')) {
                document.getElementById('qrcode').innerHTML = "";
                // QR ലിങ്കിൽ നിന്നും admin=true ഒഴിവാക്കി വേണം മറ്റുള്ളവർക്ക് നൽകാൻ
                const shareUrl = window.location.origin + window.location.pathname;
                new QRCode(document.getElementById('qrcode'), { text: shareUrl, width: 180, height: 180 });
            }
        }

        async function downloadAllZip() {
            if(photos.length === 0) return alert("No photos to download");
            const zip = new JSZip();
            photos.forEach((data, i) => {
                const imgData = data.split(',')[1];
                zip.file(`photo_${i+1}.jpg`, imgData, {base64: true});
            });
            const content = await zip.generateAsync({type:"blob"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = "frames_by_arju.zip";
            link.click();
        }
    </script>
</body>
</html>
